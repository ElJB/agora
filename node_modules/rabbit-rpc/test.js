var RpcClient = require('./client.js'),
	RpcServer = require('./server.js'),
	assert = require('assert'),
	Q = require('q');

var multiply = new RpcClient('multiply'),
	server = new RpcServer('multiply', function(args){
		var deferred = Q.defer();

		deferred.resolve(args.reduce(function(a, b){
			return a * b;
		}));

		return deferred.promise;
	});

multiply.once("connected", function(){
	multiply.call([4, 5])
		.then(function(result){
			assert.equal(result, 20);
			console.log("rabbit-rpc test: OK")
		})
		.catch(function(err){
			console.log(err.stack);
		});
});
