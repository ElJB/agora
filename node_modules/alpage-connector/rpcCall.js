var Alpage = require('./connector.js'),
	RpcServer = require('rabbit-rpc').Server,
	Q = require('q');

var alpageRpc = new RpcServer('alpage', function(args){
	var deferred = Q.defer();

	var alpage = new Alpage(args);
	alpage.parse()
		.then(function(tree){
			deferred.resolve(tree.lemmaString());
		}).catch(function(err){
			console.log(err.stack);
			deferred.resolve("");
		});

	return deferred.promise;
});